{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/ewt-all-in-one-1/Desktop/Chat-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/ewt-all-in-one-1/Desktop/Chat-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/ewt-all-in-one-1/Desktop/Chat-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import Camera from\"../components/svg/Camera\";import Img from\"../image1.jpg\";import{storage,db,auth}from\"../firebase\";import{ref,getDownloadURL,uploadBytes,deleteObject}from\"firebase/storage\";import{getDoc,doc,updateDoc}from\"firebase/firestore\";import Delete from\"../components/svg/Delete\";import{useHistory}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Profile=function Profile(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),img=_useState2[0],setImg=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var history=useHistory(\"\");useEffect(function(){getDoc(doc(db,\"users\",auth.currentUser.uid)).then(function(docSnap){if(docSnap.exists){setUser(docSnap.data());}});if(img){var uploadImg=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var imgRef,snap,url;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:imgRef=ref(storage,\"avatar/\".concat(new Date().getTime(),\" - \").concat(img.name));_context.prev=1;if(!user.avatarPath){_context.next=5;break;}_context.next=5;return deleteObject(ref(storage,user.avatarPath));case 5:_context.next=7;return uploadBytes(imgRef,img);case 7:snap=_context.sent;_context.next=10;return getDownloadURL(ref(storage,snap.ref.fullPath));case 10:url=_context.sent;_context.next=13;return updateDoc(doc(db,\"users\",auth.currentUser.uid),{avatar:url,avatarPath:snap.ref.fullPath});case 13:setImg(\"\");_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](1);console.log(_context.t0.message);case 19:case\"end\":return _context.stop();}}},_callee,null,[[1,16]]);}));return function uploadImg(){return _ref.apply(this,arguments);};}();uploadImg();}},[img]);var deleteImage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var confirm;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;confirm=window.confirm(\"Delete avatar?\");if(!confirm){_context2.next=8;break;}_context2.next=5;return deleteObject(ref(storage,user.avatarPath));case 5:_context2.next=7;return updateDoc(doc(db,\"users\",auth.currentUser.uid),{avatar:\"\",avatarPath:\"\"});case 7:history.replace(\"/\");case 8:_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0.message);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function deleteImage(){return _ref2.apply(this,arguments);};}();return user?/*#__PURE__*/_jsx(\"section\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"profile_container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"img_container\",children:[/*#__PURE__*/_jsx(\"img\",{src:user.avatar||Img,alt:\"avatar\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overlay\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"photo\",children:/*#__PURE__*/_jsx(Camera,{})}),user.avatar?/*#__PURE__*/_jsx(Delete,{deleteImage:deleteImage}):null,/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",style:{display:\"none\"},id:\"photo\",onChange:function onChange(e){return setImg(e.target.files[0]);}})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text_container\",children:[/*#__PURE__*/_jsx(\"h3\",{children:user.name}),/*#__PURE__*/_jsx(\"p\",{children:user.email}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"small\",{children:[\"Joined on: \",user.createdAt.toDate().toDateString()]})]})]})}):null;};export default Profile;","map":{"version":3,"sources":["C:/Users/ewt-all-in-one-1/Desktop/Chat-app/src/pages/Profile.js"],"names":["React","useState","useEffect","Camera","Img","storage","db","auth","ref","getDownloadURL","uploadBytes","deleteObject","getDoc","doc","updateDoc","Delete","useHistory","Profile","img","setImg","user","setUser","history","currentUser","uid","then","docSnap","exists","data","uploadImg","imgRef","Date","getTime","name","avatarPath","snap","fullPath","url","avatar","console","log","message","deleteImage","confirm","window","replace","display","e","target","files","email","createdAt","toDate","toDateString"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Camera from \"../components/svg/Camera\";\r\nimport Img from \"../image1.jpg\";\r\nimport { storage, db, auth } from \"../firebase\";\r\nimport {\r\n  ref,\r\n  getDownloadURL,\r\n  uploadBytes,\r\n  deleteObject,\r\n} from \"firebase/storage\";\r\nimport { getDoc, doc, updateDoc } from \"firebase/firestore\";\r\nimport Delete from \"../components/svg/Delete\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nconst Profile = () => {\r\n  const [img, setImg] = useState(\"\");\r\n  const [user, setUser] = useState();\r\n  const history = useHistory(\"\");\r\n\r\n  useEffect(() => {\r\n    getDoc(doc(db, \"users\", auth.currentUser.uid)).then((docSnap) => {\r\n      if (docSnap.exists) {\r\n        setUser(docSnap.data());\r\n      }\r\n    });\r\n\r\n    if (img) {\r\n      const uploadImg = async () => {\r\n        const imgRef = ref(\r\n          storage,\r\n          `avatar/${new Date().getTime()} - ${img.name}`\r\n        );\r\n        try {\r\n          if (user.avatarPath) {\r\n            await deleteObject(ref(storage, user.avatarPath));\r\n          }\r\n          const snap = await uploadBytes(imgRef, img);\r\n          const url = await getDownloadURL(ref(storage, snap.ref.fullPath));\r\n\r\n          await updateDoc(doc(db, \"users\", auth.currentUser.uid), {\r\n            avatar: url,\r\n            avatarPath: snap.ref.fullPath,\r\n          });\r\n\r\n          setImg(\"\");\r\n        } catch (err) {\r\n          console.log(err.message);\r\n        }\r\n      };\r\n      uploadImg();\r\n    }\r\n  }, [img]);\r\n\r\n  const deleteImage = async () => {\r\n    try {\r\n      const confirm = window.confirm(\"Delete avatar?\");\r\n      if (confirm) {\r\n        await deleteObject(ref(storage, user.avatarPath));\r\n\r\n        await updateDoc(doc(db, \"users\", auth.currentUser.uid), {\r\n          avatar: \"\",\r\n          avatarPath: \"\",\r\n        });\r\n        history.replace(\"/\");\r\n      }\r\n    } catch (err) {\r\n      console.log(err.message);\r\n    }\r\n  };\r\n  return user ? (\r\n    <section>\r\n      <div className=\"profile_container\">\r\n        <div className=\"img_container\">\r\n          <img src={user.avatar || Img} alt=\"avatar\" />\r\n          <div className=\"overlay\">\r\n            <div>\r\n              <label htmlFor=\"photo\">\r\n                <Camera />\r\n              </label>\r\n              {user.avatar ? <Delete deleteImage={deleteImage} /> : null}\r\n              <input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                style={{ display: \"none\" }}\r\n                id=\"photo\"\r\n                onChange={(e) => setImg(e.target.files[0])}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"text_container\">\r\n          <h3>{user.name}</h3>\r\n          <p>{user.email}</p>\r\n          <hr />\r\n          <small>Joined on: {user.createdAt.toDate().toDateString()}</small>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  ) : null;\r\n};\r\n\r\nexport default Profile;\r\n"]},"metadata":{},"sourceType":"module"}